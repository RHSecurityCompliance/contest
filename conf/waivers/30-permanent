# these tests are always expected to fail, because there's no reasonable way
# to fix them, or because we intentionally expect the failure and a pass should
# trigger alarms and be invetigated

# we cannot influence how host-os was installed (ie. Beaker), and since FIPS
# works only when the OS was installed with fips=1, this will likely fail
/hardening/host-os/.+/enable_fips_mode
    True

# remediation for this is globally disabled in Contest,
# see conf/remediation.py
/hardening/.+/accounts_password_set_max_life_(existing|root)
/hardening/.+/sshd_disable_root_login
    True

# missing Ansible remediation
# - we need to track these as manual waivers, because the current lib/oscap.py
#   logic checks only Bash remediation and there is no clear approach to
#   extending it with Ansible that wouldn't break existing logic (ie. for rules
#   that have only Bash remediation)
# - also https://github.com/ComplianceAsCode/content/issues/13125
/hardening(/.+)?/ansible(/.+)?/audit_rules_usergroup_modification
/hardening(/.+)?/ansible(/.+)?/audit_rules_unsuccessful_file_modification
/hardening(/.+)?/ansible(/.+)?/audit_rules_login_events
    True

# the service_sssd_enabled will be failing even if the service is enabled
# because it requires manual configuration which cannot be attained with our rules
# note that there are cases when sssd can be started
/hardening/.+/service_sssd_enabled
    True

# Beaker-specific:
# all Beaker repositories have gpgcheck=0 and they get copied to nested VMs too
/(hardening|scanning)/.+/ensure_gpgcheck_never_disabled
# we don't control partitions on the host OS
/hardening/host-os/.+/mount_option_(home|opt|srv|var|var_log|var_log_audit|tmp)_(noexec|nosuid|nodev|usrquota|grpquota)
/hardening/host-os/.+/mount_option_boot_efi_nosuid
    True
# Beaker and host-os seem to randomly fail any services enabled
# TODO: probably worth further investigation, but likely not a content issue
/hardening/host-os/oscap/[^/]+/service_.+_enabled
    True

# HTML links from datastreams waivers
#
# ignore SSL certificate expirations in html-links - these are generally
# harmless (expiration is not MITM) while being the biggest contributor
# to false positives, so just ignore them, avoiding frequent random fails
/static-checks/html-links/.+
    "failed: certificate has expired" in note
# Inaccessible until form is filled:
/static-checks/html-links/https://docs-prv.pcisecuritystandards.org/PCI%20DSS/Standard/PCI-DSS-v4_0.pdf
    True

# Rule identifiers waivers
#
# no STIG ID, but the rule is needed for other authselect rules
/static-checks/rule-identifiers/stig/enable_authselect
    rhel == 8
# no STIG ID for CentOS products
/static-checks/rule-identifiers/stig/.*
    rhel.is_centos() and note == 'missing https://public.cyber.mil/stigs/downloads/?_dl_facet_stigs=operating-systems%2Cunix-linux'

# DISA Alignment waivers
#
# DISA benchmark allows only released OS versions. Our content is fine with unreleased versions.
# https://github.com/ComplianceAsCode/content/issues/11649
/scanning/disa-alignment/.*/installed_OS_is_vendor_supported
    True
# This sysctl setting breaks some services and according to STIG it can be skipped if there is a need
# https://github.com/ComplianceAsCode/content/pull/12824
/scanning/disa-alignment/.*/sysctl_user_max_user_namespaces
    rhel >= 9

# CentOS-specific waivers
#
# Rules checking if OS is FIPS certified
/hardening/host-os/.+/sshd_use_approved_.+
/hardening/host-os/.+/package_dracut-fips_installed
/hardening/host-os/.+/grub2_enable_fips_mode
/hardening/host-os/.+/aide_use_fips_hashes
    rhel.is_centos()
# Remediations are unselected for CentOS, but they might pass outside Testing Farm
/hardening/.+/ensure_gpgcheck_globally_activated
/hardening/.+/ensure_gpgcheck_local_packages
/hardening/.+/ensure_gpgcheck_never_disabled
/hardening/.+/ensure_gpgcheck_repo_metadata
/hardening/.+/ensure_redhat_gpgkey_installed
    rhel.is_centos()
# Presumably not valid for CentOS
/hardening/.+/ospp/enable_fips_mode
/hardening/.*/ospp/configure_crypto_policy
    rhel.is_centos() and rhel == 9

# scapval waivers
#
# Caused by SCE content being built by default, enabled
# in https://github.com/ComplianceAsCode/content/pull/12488
/static-checks/nist-validation/ssg-(rhel\d+|cs\d+)-ds/SRC-118
    True

# bootc waivers

# The rules related to SSH keys fail because SSH host keys don't exist
# at container build time, they are generated by the sshd-keygen service only
# once the system is deployed by executing /usr/libexec/openssh/sshd-keygen
# script. We inform users in rules by warning text saying that remediation
# is not possible at bootable container build time because SSH host keys are
# generated post-deployment. The warning has been introduced by
# https://github.com/ComplianceAsCode/content/pull/12755.
/hardening/container/.+/file_groupownership_sshd_private_key
/hardening/container/.+/file_permissions_sshd_private_key
    True

# vim: syntax=python
